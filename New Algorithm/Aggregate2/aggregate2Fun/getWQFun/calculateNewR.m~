%% Funcion calculate new R
%  Calcula la tasa de entropia del
%  nuevo Q con el P original
%  Para esto es necesario la funcion
%  de particion, o en otras palabaras,
%  la base de datos de biparticiones.
function newR = calculateNewR(newQ,newBDB)
    % variables globales
    global P;
    global pi;
    global lP;
    
    % Calculamos T
    T = 0;
    for i=1:l;
        for j=1:l
            parT = + pi(i)*P(i,j)*...
            log2(P(i,j)/newQ(find(newBDB(i,:)),find(newBDB(j,:))));
            if isnan(parT)
                parT = 0;
            end
            T=T + parT;
        end
    end
    %Calculamos S
    S = 0;
    for i=1:l
        % Se calcula la suma de los pi partenecientes al mismo estado
        % que el estado i
        % Se puede resumir en:
        % sumPi = sum(pi([find(newBCB(:,find(newBCB(i,:))))]))
        sumPi = 0;
        for j = find(newBDB(:,find(newBDB(i,:))))'
            sumPi = sumPi +pi(j);
        end
        S = S + pi(i)*log2(pi(i)/sumPi); 
    end
    
    % Se calcula la tasa de entropia
    newR = T-S;
    
end 
